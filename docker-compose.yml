# WirelessAgent - Docker Compose Configuration
# UC Berkeley AgentX Competition Submission
# Author: Jingwen
# Date: 1/15/2026

version: '3.8'

services:
  # Green Agent - Evaluation Server (AgentBeats Compatible)
  green-agent:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: wirelessagent-green
    ports:
      - "9009:9009"
    environment:
      - PYTHONUNBUFFERED=1
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - ASSESSMENT_MODE=test
    volumes:
      - ./data:/app/data:ro
      - ./logs:/app/logs
      - ./workspace:/app/workspace
    command: ["python", "src/server.py"]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9009/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - wirelessagent-network

  # Purple Agent - Baseline Competition Agent
  # Purple Agent - Baseline Competition Agent (Round 14 Optimized)
  # Performance: 81.78% accuracy on WCHW validation set
  purple-agent:
    build:
      context: .
      dockerfile: Dockerfile.purple
    container_name: wirelessagent-purple
    ports:
      - "8081:8081"
    environment:
      - PYTHONUNBUFFERED=1
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - DASHSCOPE_API_KEY=${DASHSCOPE_API_KEY}
      - GREEN_AGENT_URL=http://green-agent:9009
      - MODEL_NAME=qwen-turbo-latest
    volumes:
      - ./config:/app/config:ro
      - ./logs:/app/logs
    command: ["python", "agents/purple_agent.py", "--port", "8081"]
    depends_on:
      green-agent:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8081/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - wirelessagent-network

networks:
  wirelessagent-network:
    driver: bridge

volumes:
  logs:
  workspace:

